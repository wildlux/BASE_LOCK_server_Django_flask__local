<!DOCTYPE html>
<!-- saved from url=(0027)http://192.168.1.165:5001/? -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
     
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>RAG System</title>
     <style>
         * {
             box-sizing: border-box;
         }
         body {
             font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
             background-color: #343541;
             color: #fff;
             margin: 0;
             padding: 0;
             height: 100vh;
             display: flex;
             flex-direction: column;
         }
         .sidebar {
             width: 260px;
             background-color: #202123;
             padding: 10px;
             border-right: 1px solid #565869;
             overflow-y: auto;
         }
         .main {
             flex: 1;
             display: flex;
             flex-direction: column;
             height: 100vh;
         }
         .header {
             padding: 10px 20px;
             border-bottom: 1px solid #565869;
             background-color: #343541;
         }
         .chat-container {
             flex: 1;
             padding: 20px;
             overflow-y: auto;
             display: flex;
             flex-direction: column;
         }
         .message {
             margin-bottom: 20px;
             padding: 10px 15px;
             border-radius: 8px;
             max-width: 80%;
         }
         .user-message {
             background-color: #10a37f;
             align-self: flex-end;
             text-align: right;
         }
         .bot-message {
             background-color: #444654;
             align-self: flex-start;
         }
         .input-area {
             padding: 10px 20px;
             border-top: 1px solid #565869;
             background-color: #343541;
             display: flex;
             align-items: center;
         }
         #queryInput {
             flex: 1;
             padding: 10px 15px;
             border: 1px solid #565869;
             border-radius: 8px;
             background-color: #40414f;
             color: #fff;
             margin-right: 10px;
         }
         #queryInput::placeholder {
             color: #8e8ea0;
         }
         button {
             background-color: #10a37f;
             color: white;
             padding: 10px 15px;
             border: none;
             border-radius: 8px;
             cursor: pointer;
         }
         button:hover {
             background-color: #0e8b6e;
         }
         .upload-area {
             margin-bottom: 20px;
             padding: 15px;
             background-color: #40414f;
             border-radius: 8px;
         }
         #fileInput {
             margin-bottom: 10px;
         }
         select {
             padding: 10px;
             border: 1px solid #565869;
             border-radius: 8px;
             background-color: #40414f;
             color: #fff;
             margin-bottom: 10px;
         }
     </style>
 </head>
 <body>
     <div class="sidebar">
         <h2>RAG System</h2>
         <div class="upload-area">
             <h3>Upload File</h3>
             <input type="file" name="file" id="fileInput" style="display: none;" onchange="uploadFile()">
             <button type="button" onclick="document.getElementById(&#39;fileInput&#39;).click()">Choose File</button>
         </div>
         <label for="modelSelect">Model:</label>
         <select id="modelSelect"><option value="llama">llama</option><option value="alpaca">alpaca</option><option value="vicuna">vicuna</option><option value="gpt4all">gpt4all</option></select>
     </div>
     <div class="main">
         <div class="header">
             <h1>Chat with RAG</h1>
         </div>
         <div class="chat-container" id="chatContainer">
             <div class="message bot-message">
                 <p>Welcome to the RAG System! Upload a file and ask questions about its content.</p>
             </div>
             <div id="response"></div>
         </div>
         <div class="input-area">
             <input type="text" id="queryInput" placeholder="Type your message here...">
             <button type="button" onclick="submitQuery()">Send</button>
         </div>
     </div>

     <script>
         // Fetch available models and populate the dropdown
         function fetchModels() {
             fetch("/models")
                 .then(response => response.json())
                 .then(data => {
                     const modelSelect = document.getElementById("modelSelect");
                     data.models.forEach(model => {
                         const option = document.createElement("option");
                         option.value = model;
                         option.textContent = model;
                         modelSelect.appendChild(option);
                     });
                 })
                 .catch(error => console.error("Error fetching models:", error));
         }

         // Upload file
         function uploadFile() {
             const formData = new FormData();
             const fileInput = document.getElementById("fileInput");
             formData.append("file", fileInput.files[0]);

             fetch("/upload", {
                 method: "POST",
                 body: formData
             })
             .then(response => response.json())
             .then(data => {
                 const chatContainer = document.getElementById("chatContainer");
                 const messageDiv = document.createElement("div");
                 messageDiv.className = "message bot-message";
                 messageDiv.innerHTML = `<p>${data.message || data.error}</p>`;
                 chatContainer.appendChild(messageDiv);
             })
             .catch(error => console.error("Error:", error));
         }

         // Submit query
         function submitQuery() {
             const queryInput = document.getElementById("queryInput");
             const queryText = queryInput.value.trim();
             if (!queryText) return;

             // Add user message to chat
             const chatContainer = document.getElementById("chatContainer");
             const userMessageDiv = document.createElement("div");
             userMessageDiv.className = "message user-message";
             userMessageDiv.innerHTML = `<p>${queryText}</p>`;
             chatContainer.appendChild(userMessageDiv);

             const selectedModel = document.getElementById("modelSelect").value;

             fetch("/query", {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json"
                 },
                 body: JSON.stringify({ query: queryText, model: selectedModel })
             })
             .then(response => response.json())
             .then(data => {
                 const botMessageDiv = document.createElement("div");
                 botMessageDiv.className = "message bot-message";
                 botMessageDiv.innerHTML = `<p>${data.response || data.error}</p>`;
                 chatContainer.appendChild(botMessageDiv);
                 queryInput.value = "";
                 chatContainer.scrollTop = chatContainer.scrollHeight;
             })
             .catch(error => console.error("Error:", error));
         }

         // Allow Enter to submit
         document.getElementById("queryInput").addEventListener("keypress", function(event) {
             if (event.key === "Enter") {
                 submitQuery();
             }
         });

         // Load models on page load
         document.addEventListener("DOMContentLoaded", fetchModels);
     </script>

</body></html>